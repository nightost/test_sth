/*! test-grunt 2014-07-29 */
function checkMobile(a){var b=/^1[3|4|5|8][0-9]\d{8}$/;return b.test($.trim($(a).val()))?!0:!1}function checkNum(a){var b=/\d*/;return b.test(a)?!0:!1}function is_weixin(){var a=navigator.userAgent.toLowerCase();return"micromessenger"==a.match(/MicroMessenger/i)?!0:!1}function eatBeef(a){function b(){$("img.progress").animate({width:"0px"},1e3*o,"linear",function(){c(n)})}function c(a){$(".steamer").attr("src",$(".steamer").attr("data-src2")),m.unbind("click touchstart touchend mouseup mousedown"),$(".time-up").show(),setTimeout(function(){e(a),d()},1500)}function d(){var b="./insertTroopScore",c=($.trim($("#reqIp").val()),$.trim($("#troop").text()));if(c)var d={wixinId:_winxinid,scoreValue:l,troopId:c};else var d={wixinId:_winxinid,scoreValue:l};var f="inparam="+encodeURIComponent(JSON.stringify(d)),g=$.ajax({url:b,dataType:"json",type:"POST",data:f,timeout:5e3,success:function(a){if(a.record&&(j=a.record,parseInt(j)>90)){var b=0;a.globalRecord&&(b=a.globalRecord),$("#uni-text #uni-record").text(b),$("#uni-text").show()}console.log("分数提交成功"),$("#score i").text(j),$("#score").show(),$("#spinner").hide()},error:function(b,c){console.log("分数提交失败"),e(a),"timeout"==c&&(g.abort(),console.log("超时"))},complete:function(a,b){"timeout"==b&&console.log("超时")}})}function e(a){g=!0,$("#detail_link").bind("click",function(a){a.preventDefault(),window.location.href="http://mp.weixin.qq.com/s?__biz=MzA4NzgwMTQyNw==&mid=201124496&idx=1&sn=f9f8ba913851b6f93bd6c5f1d6e74f6a#rd"}),20>=l?(a.chatStr=l+"块牛肉不过瘾，打败了 <span id='score' style='display:none'><i>"+j+"</i>%</span> <span id='spinner'></span> 的玩家 ! 咋们得牛逼啊！！",f(1)):l>20&&35>=l?(a.chatStr="我勒个去，你只吃了"+l+"个牛肉，打败了 <span id='score' style='display:none'><i>"+j+"</i>%</span> <span id='spinner'></span> 的玩家 ! 太慢了吧。。",f(1)):l>35&&50>=l?(a.chatStr="胃口不错，一口气吃"+l+"个，打败了 <span id='score' style='display:none'><i>"+j+"</i>%</span> <span id='spinner'></span> 的玩家 ! 吃完牛肉记来碗汤",f(2)):l>50&&65>=l?(a.chatStr="万万没有想到！你吃了"+l+"个牛肉！打败了 <span id='score' style='display:none'><i>"+j+"</i>%</span> <span id='spinner'></span> 的玩家 ! 放开吃，吃完哥请你喝牛肉汤！",f(2)):l>65&&80>=l?(a.chatStr="你吃了"+l+"个牛肉，打败了 <span id='score' style='display:none'><i>"+j+"</i>%</span> <span id='spinner'></span> 的玩家 ! 看样子你根本停不下来，加油，再来一次更牛的！！",f(2)):l>80&&95>=l?(a.chatStr="你吃了"+l+"个牛肉，打败了 <span id='score' style='display:none'><i>"+j+"</i>%</span> <span id='spinner'></span> 的玩家 ! 这样的速度，标准的一吃货啊！！ ！",f(3)):l>95&&110>=l?(a.chatStr="你吃了"+l+"个牛肉，打败了 <span id='score' style='display:none'><i>"+j+"</i>%</span> <span id='spinner'></span> 的玩家 ! 我看你天赋异禀、骨骼惊奇，想来是百年难得一见的吃货奇才！",f(3)):l>110&&125>=l?(a.chatStr="我勒个去，你吃了"+l+"个牛肉…打败了 <span id='score' style='display:none'><i>"+j+"</i>%</span> <span id='spinner'></span> 的玩家 ! …说点什么好？记得吃药…。",f(3)):l>125&&140>=l?(a.chatStr="你吃了"+l+"个牛肉。打败了 <span id='score' style='display:none'><i>"+j+"</i>%</span> <span id='spinner'></span> 的玩家 ! 你这么吊，你爸妈知道么？",f(3)):l>140&&170>=l?(a.chatStr=l+"个牛肉？？不敢相信！！打败了 <span id='score' style='display:none'><i>"+j+"</i>%</span> <span id='spinner'></span> 的玩家 ! 人类已经无法阻止你吃牛肉了！！",f(3)):l>170&&(a.chatStr=l+"个牛肉？？不敢相信！！打败了<span id='score' style='display:none'><i>"+j+"</i>%</span> <span id='spinner'></span> 的玩家 ! 你确定你没作弊？？？",f(3)),h="我在《吃牛肉大赛》中吃掉了"+l+"个牛肉，打败了",$(".start-eat").hide(),$(".result-box .result-info .result-text").html(a.chatStr),$(".result-box").show(),setTimeout(function(){$("#detail_link").addClass("rotated")},1e3)}function f(a){switch($(".head").hide(),$(".hands").hide(),a){case 1:$(".state-1").show();break;case 2:$(".state-2").show();break;case 3:$(".state-3").show()}}var g=!1,h="";this.chatStr="";var i=!1,j="0",k=a||{},l=0,m=$(".start-eat"),n=this;this.getStr=function(){return h},this.getRecord=function(){return j},this.getNum=function(){return l};try{var o=k.maxTime}catch(p){console.log("Error:"+p)}this.init=function(){m.bind("touchstart mousedown",function(){$(this).addClass("start-eat-hover")}),m.bind("touchend mouseup",function(){$(this).removeClass("start-eat-hover")}),m.data("step",1),m.bind("touchstart",function(){i||(i=!0,b());var a=m.data("step");switch(a){case 1:showHands(5,1),showheads(2),m.data("step",2);break;case 2:showHands(a-1,2),showheads(3),m.data("step",3);break;case 3:showHands(a-1,3),showheads(2),m.data("step",4);break;case 4:showHands(a-1,4),m.data("step",5);break;case 5:showHands(a-1,5),showheads(4),m.data("step",1)}l++,l>15&&$(".steamer").attr("src",$(".steamer").attr("data-src1")),$(".pro-num").text(l)})},this.init()}function showHands(a,b){var c="#step-"+a,d="#step-"+b;$(c).css("display","none"),$(d).css("display","block")}function showheads(a){var b={head1:"static/events/images/eating/c25.png",head2:"static/events/images/eating/c27.png",head3:"static/events/images/eating/c26.png",head4:"static/events/images/eating/c28.png"};$(".head").attr("src",b["head"+a])}function sendMessage(){_eatBeef.getStr();WeixinJSBridge.on("menu:share:timeline",function(){WeixinJSBridge.invoke("shareTimeline",{appid:"",img_url:"http://115.29.35.199/images/eatBeef/eatBeef.jpg",img_width:"120",img_height:"120",link:"http://115.29.35.199/gamecenter/eatBeef?share=true",desc:"吃牛肉啦，看看大侠什么水平~",title:_eatBeef.getStr()+_eatBeef.getRecord()+"%的玩家 !!!"},function(){sendIp()})}),WeixinJSBridge.on("menu:share:appmessage",function(){WeixinJSBridge.invoke("sendAppMessage",{appid:"",img_url:"http://115.29.35.199/images/eatBeef/eatBeef.jpg",img_width:"120",img_height:"120",link:"http://115.29.35.199/gamecenter/eatBeef?share=true",desc:"吃牛肉啦，看看大侠什么水平~",title:_eatBeef.getStr()+_eatBeef.getRecord()+"%的玩家 !!!"},function(){sendIp()})}),WeixinJSBridge.on("menu:share:weibo",function(){WeixinJSBridge.invoke("shareWeibo",{content:_eatBeef.getStr()+_eatBeef.getRecord()+"%的玩家 !!!",url:"http://115.29.35.199/gamecenter/eatBeef?share=true"},function(){sendIp()})})}function sendIp(){var a="./gameLog",b=$.trim($("#reqIp").val()),c={wixinId:_winxinid,toId:$.trim($("#toId").val()),reqIp:b},d="inparam="+encodeURIComponent(JSON.stringify(c));$.ajax({url:a,dataType:"json",type:"POST",data:d,success:function(){console.log("提交成功")},error:function(){console.log("提交失败")}})}var _eatBeef,_winxinid="";$(function(){_winxinid=$.trim($("#wixinId").val()),$(document).bind("touchmove",function(a){a.preventDefault()}),_eatBeef=new eatBeef({maxTime:15})}),is_weixin()&&document.addEventListener("WeixinJSBridgeReady",function(){sendMessage()});